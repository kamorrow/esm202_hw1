---
title: ESM 202 Assignment 1
author: Keene Morrow
date: 1/21/2020
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(janitor)
library(here)
library(kableExtra)
```

```{r, include = FALSE}
# Set up
ch_wshd_A <- 165740 # km^2
ch_wshd_A_m <- ch_wshd_A * 1000 ^ 2 # m^2
ch_tot_inflow <- 1833 #m/s^2
ch_tot_V <- 68 # km^3
ch_tot_V_m <- ch_tot_V * 10 ^ 9 # m^3

# Long term nutrient inputs to rivers
sus_char <- c("rural", "forested", "agricultural") # Susquehanna
pot_char <- c("urban", "agricultural") # Potomac
cho_char <- "agricultural" # Choptank

# River Info
rivers <- read_csv(here("data", "river_info.csv")) %>%
  janitor::clean_names()

# Water Quality Parameters
wq_param <- read_csv(here("data", "wq_param.csv"))
```

### 1. Mass Balance

#### a) Calculate the percent contribution of each river to the total water flux into the Chesapeake Bay. 
```{r}
river_contrib <- rivers %>%
  mutate(pct_contrib = round((mean_flow_m3_s / ch_tot_inflow)*100, digits = 2)) %>%
  select(river, pct_contrib) %>%
  rename("Percent Contribution" = pct_contrib,
         River = river)
```


```{r, include = FALSE}
kable(river_contrib)%>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "center"
                ) %>% 
  add_header_above(c("Table 1.\nPercent Contribution to Chesapeake Bay Flux by River" = 2))
```

#### b) Considering the rivers as the total inflow, what is the approximate turnover time for water in the Chesapeake Bay? Assume that tidal exchange has no net effect on the total volume of the Chesapeake Bay. 

```{r}
# Chesapeake Bay turnover in seconds
ch_turnover <- ch_tot_V_m / ch_tot_inflow

# Chesapeake Bay turnover in days
ch_turn_days <- ch_turnover / (60 ^ 2 * 24)

# Chesapeake Bay turnover in years
ch_turn_yr <- ch_turn_days / 365.25
```

The turnover time of the Chesapeake Bay is `r round(ch_turn_days, digits = 2)` days or `r round(ch_turn_yr, digits = 2)` years.

#### c) What is the mean concentration (in μg/L) of total nitrogen (TN) and total phosphorus (TP) entering the Chesapeake Bay from each river (only SUS, POT and CHO) in the 1st quarter of 2010?

```{r}
# Total Phosphorus kg/day, 2010, Quarter 1, in order, SUS, POT, CHO
tp_2010_q1_kg_d <- c(1.6 * 7200, 1.4 * 4700, 1.5 * 40)

# Total Nitrogen kg/day, 2010, Quarter 1, in order, SUS, POT, CHO
tn_2010_q1_kg_d <- c(1.5 * 160000, 1.5 * 64000, 1.75 * 600)

rivers_ug_L <- rivers %>%
  # only the rivers of interest
  filter(river_abb %in% c("SUS", "POT", "CHO")) %>%
  # add TP and TN data from above
  cbind(tp_2010_q1_kg_d,
        tn_2010_q1_kg_d) %>% 
  # Conversions
  mutate(mean_flow_L_s = mean_flow_m3_s * 1000,
         tp_2010_q1_ug_d = tp_2010_q1_kg_d * 10 ^ 9,
         tn_2010_q1_ug_d = tn_2010_q1_kg_d * 10 ^ 9) %>%
  mutate(tp_2010_q1_ug_s = tp_2010_q1_ug_d / 86400,
         tn_2010_q1_ug_s = tn_2010_q1_ug_d / 86400) %>%
  # Calculate Mean Concentration of TP and TN in each river
  mutate(mean_conc_tp_2010_q1_ug_L = tp_2010_q1_ug_s / mean_flow_L_s,
         mean_conc_tn_2010_q1_ug_L = tn_2010_q1_ug_s / mean_flow_L_s)

# Prep df for table
mean_conc_2010 <- rivers_ug_L %>%
  select(river, mean_conc_tp_2010_q1_ug_L, mean_conc_tn_2010_q1_ug_L) %>%
  mutate(mean_conc_tp_2010_q1_ug_L = round(mean_conc_tp_2010_q1_ug_L, digits = 2),
         mean_conc_tn_2010_q1_ug_L= round(mean_conc_tn_2010_q1_ug_L, digits = 2)) %>% 
  rename("Total Phosphorus" = mean_conc_tp_2010_q1_ug_L,
         "Total Nitrogen" = mean_conc_tn_2010_q1_ug_L,
         River = river)
```


```{r, echo = FALSE}
kable(mean_conc_2010)%>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "center"
                ) %>% 
  add_header_above(c("Table 2.\nMean Concentrations (μg/L) entering the Chesapeake Bay by River\nQuarter 1, 2010" = 3))

```

#### d) Express the concentrations of TN and TP also in terms of moles/L of N and P. 

```{r}
N_atomic <- 14.00 # g / mol
P_atomic <- 30.97 # g / mol

N_ug_mol <- N_atomic * 10 ^ 6 # ug / mol
P_ug_mol <- P_atomic * 10 ^ 6 # ug / mol

mean_conc_2010_mol_L <- rivers_ug_L %>%
  # Convert ug/L to mol/L
  mutate(mean_conc_tp_2010_q1_mol_L = mean_conc_tp_2010_q1_ug_L / P_ug_mol,
         mean_conc_tn_2010_q1_mol_L = mean_conc_tn_2010_q1_ug_L / N_ug_mol) %>%
  # Prep for table
  select(river, mean_conc_tp_2010_q1_mol_L, mean_conc_tn_2010_q1_mol_L) %>%
  mutate(mean_conc_tp_2010_q1_mol_L = formatC(mean_conc_tp_2010_q1_mol_L, format = "e", digits = 2),
         mean_conc_tn_2010_q1_mol_L= formatC(mean_conc_tn_2010_q1_mol_L, format= "e", digits = 2)) %>%
  rename("Total Phosphorus" = mean_conc_tp_2010_q1_mol_L,
         "Total Nitrogen" = mean_conc_tn_2010_q1_mol_L,
         River = river)
```


```{r, echo = FALSE}
kable(mean_conc_2010_mol_L)%>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "center"
                ) %>% 
  add_header_above(c("Table 3.\nMean Concentrations (mol/L) entering the Chesapeake Bay by River\nQuarter 1, 2010" = 3))

```


#### e) How many kg of TN and TP are being discharged into the Chesapeake Bay from each river (only SUS, POT and CHO) in the 1st quarter of 2010? 

```{r}
t_q1_d <- 31 + # January
  28 + # February
  31 # March

rivers_kg_q1 <- rivers %>%
  # only the rivers of interest
  filter(river_abb %in% c("SUS", "POT", "CHO")) %>%
  # add TP and TN data from above
  cbind(tp_2010_q1_kg_d,
        tn_2010_q1_kg_d) %>%
  mutate(tp_2010_q1_kg_qtr = tp_2010_q1_kg_d * t_q1_d,
         tn_2010_q1_kg_qtr = tn_2010_q1_kg_d * t_q1_d) %>%
  select(river, tp_2010_q1_kg_qtr, tn_2010_q1_kg_qtr) %>%
  rename("Total Phosphorus" = tp_2010_q1_kg_qtr,
         "Total Nitrogen" = tn_2010_q1_kg_qtr,
         River = river)
```

```{r echo = FALSE}
kable(rivers_kg_q1)%>% 
  kable_styling(bootstrap_options = "striped", 
                full_width = F,
                position = "center"
                ) %>% 
  add_header_above(c("Table 4.\nTotal Contribution (kg) entering the Chesapeake Bay by River \nQuarter 1, 2010" = 3))
```

#### f) Approximately what fraction of the total mass of N and P is coming in as dissolved N (DN) or dissolved P (DP) in the 1st quarter of 2010?


#### g) Calculate the total mass/day of suspended sediments being added to the Chesapeake Bay during the 1st quarter of 2010 by each river.


### 2. Water quality (consider only the SUS, POT and CHO or as indicated)

#### a) Given the molar ratio of 100:16:1 [C:N:P], which nutrient would be limiting in each river during the 1st quarter of 2010?


#### b) Given the molar ratio of 100:16:1 [C:N:P] and given the molar ratio of C:H:O for biomass as 1:2:1, is the dissolved nitrogen during the 1st quarter of 2012 likely to deplete oxygen in the Choptank River? Assume the dissolved oxygen is 4.5 mg/L in the receiving water at the point of discharge.

#### c) Free Space

#### d) Given the concentrations of TN and TP, how would you classify the eutrophication potential of each of the three rivers in terms in the Chesapeake Bay in 1980 and 2010? 

#### e) What other important water quality parameter(s) are important to determine the health of aquatic organisms (e.g. fish) in these three tributaries? Briefly discuss at least 5.


#### f) Given the loadings of N and P, qualitatively discuss the likely redox conditions in the Chesapeake Bay sediments. What are the implications (briefly)? 

#### g) For the data sets provided (1980 to 2010), discuss the relative improvement/degradation of each river in the Chesapeake Bay. 
